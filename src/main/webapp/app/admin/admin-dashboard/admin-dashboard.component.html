<div class="app-content">
  <div class="container mt-4">
    <h2 class="text-center fw-bold mb-4">Espace Administrateur</h2>

    <!-- Tabs -->
    <div class="btn-group mb-4">
      <button
        class="btn"
        [ngClass]="{ 'btn-success text-white': activeTab === 'users', 'btn-outline-secondary': activeTab !== 'users' }"
        (click)="setTab('users')"
      >
        üë• Utilisateurs
      </button>
      <button
        class="btn"
        [ngClass]="{ 'btn-success text-white': activeTab === 'transactions', 'btn-outline-secondary': activeTab !== 'transactions' }"
        (click)="setTab('transactions')"
      >
        ‚úÖ Transactions
      </button>
      <button
        class="btn"
        [ngClass]="{ 'btn-success text-white': activeTab === 'logs', 'btn-outline-secondary': activeTab !== 'logs' }"
        (click)="setTab('logs')"
      >
        üìú Logs
      </button>
      <button
        class="btn"
        [ngClass]="{ 'btn-success text-white': activeTab === 'accounts', 'btn-outline-secondary': activeTab !== 'accounts' }"
        (click)="setTab('accounts')"
      >
        üè¶ Comptes
      </button>
    </div>

    <!-- Users -->
    <div *ngIf="activeTab === 'users'">
      <div class="card p-4">
        <h4 class="text-success mb-3">Utilisateurs</h4>
        <table class="table table-bordered table-striped">
          <thead class="table-light">
            <tr>
              <th>Email</th>
              <th>R√¥le</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users">
              <td>{{ user.email }}</td>
              <td>{{ user.role?.nom || '‚Äî' }}</td>
              <td>
                <button class="btn btn-sm btn-primary me-2" (click)="editUser(user)">Modifier</button>
                <button class="btn btn-sm btn-danger" (click)="deleteUser(user.id)">Supprimer</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Modal -->
      <div *ngIf="editingUser" class="modal-backdrop">
        <div class="modal-container">
          <h5>Modifier le r√¥le de l'utilisateur</h5>
          <p><strong>Email:</strong> {{ editingUser.email }}</p>

          <label for="role">Nouveau r√¥le</label>
          <select id="role" [(ngModel)]="selectedRoleId" class="form-control mb-3">
            <option *ngFor="let role of availableRoles" [value]="role.id">{{ role.nom }}</option>
          </select>

          <div class="d-flex justify-content-end">
            <button class="btn btn-secondary me-2" (click)="closeModal()">Annuler</button>
            <button class="btn btn-success" (click)="updateUserRole()">Enregistrer</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Transactions Validation -->
    <div *ngIf="activeTab === 'transactions'">
      <div class="card p-4">
        <h4 class="text-success mb-3">Transactions importantes √† valider</h4>
        <div *ngIf="transactions.length === 0" class="text-muted">Aucune transaction √† valider.</div>
        <div *ngFor="let tx of transactions" class="border p-3 mb-2 rounded">
          <p>
            <strong>Montant :</strong> {{ tx.montant }} ‚Ç¨ | <strong>De :</strong> {{ tx.compteSource?.iban || '‚Äî' }} |
            <strong>√Ä :</strong>
            {{ tx.compteDestination?.iban || '‚Äî' }}

            <button class="btn btn-sm btn-outline-success float-end me-2" (click)="approveTransaction(tx.id)">Valider</button>
            <button class="btn btn-sm btn-outline-danger float-end" (click)="rejectTransaction(tx.id)">Rejeter</button>
          </p>
        </div>
      </div>
    </div>

    <!-- Logs -->
    <div *ngIf="activeTab === 'logs'">
      <div class="card p-4">
        <h4 class="text-success mb-3">Logs r√©cents</h4>

        <!-- Filter dropdown -->
        <div class="mb-3">
          <label for="filterType" class="form-label">Filtrer par type:</label>
          <select id="filterType" class="form-select w-auto" (change)="onFilterChange($event)">
            <option value="">Tous</option>
            <option value="LOGIN">LOGIN</option>
            <option value="SECURITY_ALERT">SECURITY_ALERT</option>
          </select>
        </div>

        <table class="table table-bordered table-striped">
          <thead class="table-light">
            <tr>
              <th>Horodatage</th>
              <th>Type</th>
              <th>IP Source</th>
              <th>Statut</th>
              <th>Message</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let log of filteredLogs">
              <td>{{ log.timestamp }}</td>
              <td>{{ log.action }}</td>
              <td>{{ log.ipUtilisateur }}</td>
              <td>{{ log.resultat }}</td>
              <td>{{ log.description }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <!-- Tabs -->
    <!-- Comptes Tab Content -->
    <div *ngIf="activeTab === 'accounts'">
      <div class="card p-4 shadow">
        <h4 class="text-success mb-3">Gestion des Comptes</h4>

        <!-- Search bar -->
        <div class="mb-3">
          <input
            [(ngModel)]="ibanSearch"
            (input)="filterAccounts()"
            class="form-control w-50"
            placeholder="üîç Rechercher un compte par IBAN..."
          />
        </div>

        <!-- Accounts Table -->
        <table class="table table-hover table-striped">
          <thead class="table-light">
            <tr>
              <th>IBAN</th>
              <th>Type</th>
              <th>Solde (‚Ç¨)</th>
              <th>Statut</th>
              <th>Cl√¥tur√© ?</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let account of filteredAccounts">
              <td>{{ account.iban }}</td>
              <td>{{ account.typeCompte || '‚Äî' }}</td>
              <td>{{ account.solde?.toFixed(2) }}</td>
              <td>{{ account.statut || '‚Äî' }}</td>
              <td>
                <span class="badge" [ngClass]="account.dateFermeture ? 'bg-success' : 'bg-danger'">
                  {{ account.dateFermeture ? 'Oui' : 'Non' }}
                </span>
              </td>
              <td>
                <button *ngIf="!account.dateFermeture" class="btn btn-sm btn-outline-danger" (click)="closeAccount(account.id)">
                  Cl√¥turer
                </button>
                <span *ngIf="account.dateFermeture" class="text-muted">D√©j√† cl√¥tur√©</span>
              </td>
            </tr>
          </tbody>
        </table>

        <div *ngIf="filteredAccounts.length === 0" class="text-muted mt-3">Aucun compte trouv√© pour l‚ÄôIBAN "{{ ibanSearch }}".</div>
      </div>
    </div>
  </div>
</div>
