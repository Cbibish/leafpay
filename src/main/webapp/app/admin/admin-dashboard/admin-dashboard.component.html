<div class="container mt-4">
  <h2 class="text-center fw-bold mb-4">Espace Administrateur</h2>

  <!-- Tabs -->
  <div class="btn-group mb-4">
    <button
      class="btn"
      [ngClass]="{ 'btn-success text-white': activeTab === 'users', 'btn-outline-secondary': activeTab !== 'users' }"
      (click)="setTab('users')"
    >
      ðŸ‘¥ Utilisateurs
    </button>
    <button
      class="btn"
      [ngClass]="{ 'btn-success text-white': activeTab === 'transactions', 'btn-outline-secondary': activeTab !== 'transactions' }"
      (click)="setTab('transactions')"
    >
      âœ… Transactions
    </button>
    <button
      class="btn"
      [ngClass]="{ 'btn-success text-white': activeTab === 'logs', 'btn-outline-secondary': activeTab !== 'logs' }"
      (click)="setTab('logs')"
    >
      ðŸ“œ Logs
    </button>
  </div>

  <!-- Users -->
  <div *ngIf="activeTab === 'users'">
    <div class="card p-4">
      <h4 class="text-success mb-3">Utilisateurs</h4>
      <table class="table table-bordered table-striped">
        <thead class="table-light">
          <tr>
            <th>Email</th>
            <th>RÃ´le</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users">
            <td>{{ user.email }}</td>
            <td>{{ user.role?.nom || 'â€”' }}</td>
            <td>
              <button class="btn btn-sm btn-primary me-2" (click)="editUser(user)">Modifier</button>
              <button class="btn btn-sm btn-danger" (click)="deleteUser(user.id)">Supprimer</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Modal -->
    <div *ngIf="editingUser" class="modal-backdrop">
      <div class="modal-container">
        <h5>Modifier le rÃ´le de l'utilisateur</h5>
        <p><strong>Email:</strong> {{ editingUser.email }}</p>

        <label for="role">Nouveau rÃ´le</label>
        <select id="role" [(ngModel)]="selectedRoleId" class="form-control mb-3">
          <option *ngFor="let role of availableRoles" [value]="role.id">{{ role.nom }}</option>
        </select>

        <div class="d-flex justify-content-end">
          <button class="btn btn-secondary me-2" (click)="closeModal()">Annuler</button>
          <button class="btn btn-success" (click)="updateUserRole()">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Transactions Validation -->
  <div *ngIf="activeTab === 'transactions'">
    <div class="card p-4">
      <h4 class="text-success mb-3">Transactions importantes Ã  valider</h4>
      <div *ngIf="transactions.length === 0" class="text-muted">Aucune transaction Ã  valider.</div>
      <div *ngFor="let tx of transactions" class="border p-3 mb-2 rounded">
        <p>
          <strong>Montant :</strong> {{ tx.montant }} â‚¬ | <strong>De :</strong> {{ tx.compteSource?.iban || 'â€”' }} | <strong>Ã€ :</strong>
          {{ tx.compteDestination?.iban || 'â€”' }}

          <button class="btn btn-sm btn-outline-success float-end me-2" (click)="approveTransaction(tx.id)">Valider</button>
          <button class="btn btn-sm btn-outline-danger float-end" (click)="rejectTransaction(tx.id)">Rejeter</button>
        </p>
      </div>
    </div>
  </div>

  <!-- Logs -->
  <div *ngIf="activeTab === 'logs'">
    <div class="card p-4">
      <h4 class="text-success mb-3">Logs rÃ©cents</h4>

      <!-- Filter dropdown -->
      <div class="mb-3">
        <label for="filterType" class="form-label">Filtrer par type:</label>
        <select id="filterType" class="form-select w-auto" (change)="onFilterChange($event)">
          <option value="">Tous</option>
          <option value="LOGIN">LOGIN</option>
          <option value="SECURITY_ALERT">SECURITY_ALERT</option>
        </select>
      </div>

      <table class="table table-bordered table-striped">
        <thead class="table-light">
          <tr>
            <th>Horodatage</th>
            <th>Type</th>
            <th>IP Source</th>
            <th>Statut</th>
            <th>Message</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let log of filteredLogs">
            <td>{{ log.timestamp }}</td>
            <td>{{ log.action }}</td>
            <td>{{ log.ipUtilisateur }}</td>
            <td>{{ log.resultat }}</td>
            <td>{{ log.description }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
