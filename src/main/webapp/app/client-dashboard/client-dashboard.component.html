<div class="app-content">
  <div class="container mt-5">
    <h2 class="text-center fw-bold mb-4">Bienvenu dans votre espace client</h2>

    <!-- Tabs -->
    <div class="btn-group mb-4">
      <button
        class="btn"
        [ngClass]="{
          'btn-success text-white': activeTab === 'account',
          'btn-outline-secondary': activeTab !== 'account',
        }"
        (click)="setTab('account')"
      >
        ðŸ“„ Mon Compte
      </button>
      <button
        class="btn"
        [ngClass]="{
          'btn-success text-white': activeTab === 'money',
          'btn-outline-secondary': activeTab !== 'money',
        }"
        (click)="setTab('money')"
      >
        ðŸ’° GÃ©rer mon argent
      </button>
      <button
        class="btn"
        [ngClass]="{
          'btn-success text-white': activeTab === 'transfer',
          'btn-outline-secondary': activeTab !== 'transfer',
        }"
        (click)="setTab('transfer')"
      >
        ðŸ“¤ Virement externe
      </button>
    </div>

    <!-- âœ… Account Tab -->
    <div *ngIf="activeTab === 'account'">
      <h3 class="text-success fw-bold mb-4">Mes comptes</h3>

      <div *ngIf="comptes.length > 1" class="mb-3">
        <label for="accountSelect" class="form-label">Choisir un compte</label>
        <select id="accountSelect" class="form-select" (change)="onAccountChange($event)">
          <option *ngFor="let compte of comptes" [value]="compte.compteId">{{ compte.typeCompte }} - {{ compte.iban }}</option>
        </select>
      </div>

      <div *ngIf="loading">Chargement des donnÃ©es...</div>

      <!-- Show selected compte details only -->
      <div *ngIf="!loading && selectedCompteId != null">
        <div *ngFor="let compte of comptes" [hidden]="compte.compteId !== selectedCompteId" class="card p-4 mb-3">
          <h5 class="fw-bold">{{ compte.typeCompte }} ({{ compte.roleUtilisateurSurCeCompte }})</h5>
          <p><strong>Solde total :</strong> {{ compte.solde | number: '1.2-2' }} â‚¬</p>
          <p><strong>IBAN :</strong> {{ compte.iban }}</p>
        </div>
      </div>

      <div *ngIf="!loading && comptes.length === 0" class="alert alert-info">Aucun compte trouvÃ©.</div>

      <!-- Transactions for the selected account -->
      <div *ngIf="transactions.length > 0" class="mt-4">
        <h5 class="text-success fw-bold mb-3">Transactions du compte sÃ©lectionnÃ©</h5>
        <div *ngFor="let t of transactions" class="border p-3 mb-3 rounded">
          <p><strong></strong> {{ t.typeTransaction }} â€” <strong>Montant :</strong> {{ t.montant | number: '1.2-2' }} â‚¬</p>
          <!-- You can customize transaction display here -->
        </div>
      </div>

      <div *ngIf="transactions.length === 0 && !loading" class="alert alert-warning">Aucune transaction trouvÃ©e pour ce compte.</div>
    </div>

    <!-- Money Tab -->
    <div *ngIf="activeTab === 'money'">
      <div *ngIf="comptes.length > 1" class="mb-3">
        <label for="accountSelect" class="form-label">Choisir un compte</label>
        <select id="accountSelect" class="form-select" (change)="onAccountChange($event)">
          <option *ngFor="let compte of comptes" [value]="compte.compteId">{{ compte.typeCompte }} - {{ compte.iban }}</option>
        </select>
      </div>

      <div class="card p-4">
        <h5 class="text-success fw-bold mb-3">DÃ©pÃ´t / Retrait</h5>

        <div class="mb-3">
          <label class="form-label">Montant (â‚¬)</label>
          <input type="number" class="form-control" placeholder="Ex : 100" [(ngModel)]="amount" min="0.01" />
        </div>

        <div class="mb-3">
          <label class="form-label">Type d'opÃ©ration</label>
          <select class="form-select" [(ngModel)]="operationType">
            <option value="depot">DÃ©pÃ´t</option>
            <option value="retrait">Retrait</option>
          </select>
        </div>

        <button class="btn btn-success" (click)="submitMoneyOperation()" [disabled]="!isMoneyFormValid()">Valider</button>

        <!-- Success or Error Message -->
        <div
          *ngIf="moneyOperationMessage"
          class="mt-3 alert"
          [ngClass]="{ 'alert-success': moneyOperationSuccess, 'alert-danger': !moneyOperationSuccess }"
        >
          {{ moneyOperationMessage }}
        </div>
      </div>
    </div>

    <!-- âœ… Transfer Tab -->
    <div *ngIf="activeTab === 'transfer'">
      <h3 class="text-success fw-bold mb-4">Mes Derniers virements</h3>
      <div *ngIf="comptes.length > 1" class="mb-3">
        <label for="accountSelect" class="form-label">Choisir un compte</label>
        <select id="accountSelect" class="form-select" (change)="onAccountChange($event)">
          <option *ngFor="let compte of comptes" [value]="compte.compteId">{{ compte.typeCompte }} - {{ compte.iban }}</option>
        </select>
      </div>
      <div class="card p-4">
        <h5 class="fw-bold mb-3">Derniers virements</h5>

        <div *ngIf="transferTransactions.length === 0">
          <p>Aucun virement trouvÃ©.</p>
        </div>

        <div *ngFor="let t of transferTransactions" class="border p-3 mb-3 rounded">
          <p>
            <strong>Depuis compte ID {{ t.compteSource.id }}</strong>
            &rarr; vers compte ID {{ t.compteDestination?.id }}
            <span *ngIf="t.compteDestination?.iban"> (IBAN: {{ t.compteDestination?.iban }}) </span>
            â€” Montant : {{ t.montant | number: '1.2-2' }} â‚¬
            <button class="btn btn-sm btn-outline-primary float-end">Refaire un virement</button>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
