<div class="d-flex justify-content-center">
  <div class="col-md-8">
    <h1 data-cy="registerTitle" jhiTranslate="register.title">Inscription</h1>

    <!-- Alerts -->
    <div *ngIf="success()" class="alert alert-success" jhiTranslate="register.messages.success"></div>
    <div *ngIf="error()" class="alert alert-danger" jhiTranslate="register.messages.error.fail"></div>
    <div *ngIf="errorUserExists()" class="alert alert-danger" jhiTranslate="register.messages.error.userexists"></div>
    <div *ngIf="errorEmailExists()" class="alert alert-danger" jhiTranslate="register.messages.error.emailexists"></div>
    <div *ngIf="doNotMatch()" class="alert alert-danger" jhiTranslate="global.messages.error.dontmatch"></div>

    <form *ngIf="!success()" [formGroup]="registerForm" (ngSubmit)="register()" novalidate>
      <!-- Nom -->
      <div class="mb-3">
        <label for="nom" class="form-label" jhiTranslate="register.nom.label">Nom</label>
        <input id="nom" type="text" class="form-control" formControlName="nom" />
        <small class="text-danger" *ngIf="registerForm.get('nom')?.invalid && registerForm.get('nom')?.touched">
          Le nom est obligatoire.
        </small>
      </div>

      <!-- Prénom -->
      <div class="mb-3">
        <label for="prenom" class="form-label" jhiTranslate="register.prenom.label">Prénom</label>
        <input id="prenom" type="text" class="form-control" formControlName="prenom" />
        <small class="text-danger" *ngIf="registerForm.get('prenom')?.invalid && registerForm.get('prenom')?.touched">
          Le prénom est obligatoire.
        </small>
      </div>

      <!-- Email -->
      <div class="mb-3">
        <label for="email" class="form-label" jhiTranslate="global.form.email.label">Email</label>
        <input id="email" type="email" class="form-control" formControlName="email" />
        <small class="text-danger" *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched">
          Email invalide.
        </small>
      </div>

      <!-- Mot de passe -->
      <div class="mb-3">
        <label for="motDePasse" class="form-label" jhiTranslate="register.password.label">Mot de passe</label>
        <input id="motDePasse" type="password" class="form-control" formControlName="motDePasse" />
        <jhi-password-strength-bar [passwordToCheck]="registerForm.get('motDePasse')?.value" />
      </div>

      <!-- Confirmation -->
      <div class="mb-3">
        <label for="confirmMotDePasse" class="form-label" jhiTranslate="register.confirmPassword.label">Confirmer le mot de passe</label>
        <input id="confirmMotDePasse" type="password" class="form-control" formControlName="confirmMotDePasse" />
      </div>

      <!-- Role -->
      <div class="mb-3">
        <label for="role" class="form-label" jhiTranslate="register.role.label">Type d'utilisateur</label>
        <select id="role" class="form-control" formControlName="role">
          <option *ngFor="let r of roles()" [value]="r">
            {{ r === 'NORMAL_USER' ? 'Normal' : r === 'PROFESSIONAL_USER' ? 'Professionnel' : 'Étudiant' }}
          </option>
        </select>
      </div>

      <!-- Date de naissance -->
      <div class="mb-3">
        <label for="dateNaissance" class="form-label">Date de naissance</label>
        <input id="dateNaissance" type="date" class="form-control" formControlName="dateNaissance" />
      </div>

      <!-- Justificatif -->
      <div class="mb-3">
        <label for="typeJustificatifAge" class="form-label">Justificatif d'âge</label>
        <select id="typeJustificatifAge" class="form-control" formControlName="typeJustificatifAge">
          <option value="">-- Sélectionnez --</option>
          <option *ngFor="let j of justificatifs" [value]="j">{{ j }}</option>
        </select>
      </div>

      <!-- Comptes ajoutés -->
      <div formArrayName="comptes" *ngIf="comptes.length > 0">
        <div *ngFor="let compte of comptes.controls; let i = index" [formGroupName]="i" class="border p-3 rounded mb-3">
          <div class="row">
            <div class="col-md-6 mb-2">
              <label>Type de compte</label>
              <select class="form-control" formControlName="typeCompte">
                <option *ngFor="let type of getAvailableAccountTypes(i)" [value]="type">{{ type }}</option>
              </select>
            </div>

            <div class="col-md-6 mb-2">
              <label>Solde initial</label>
              <input type="number" class="form-control" formControlName="solde" />
            </div>

            <div class="col-md-6 mb-2" *ngIf="isStudent(compte)">
              <label>Plafond transaction</label>
              <input type="number" class="form-control" formControlName="plafondTransaction" readonly />
            </div>

            <div class="col-md-6 mb-2" *ngIf="isStudent(compte) || isSaving(compte)">
              <label>Limite de retraits mensuels</label>
              <input type="number" class="form-control" formControlName="limiteRetraitsMensuels" readonly />
            </div>

            <div class="col-md-12 mb-2">
              <label>IBAN</label>
              <input type="text" class="form-control" formControlName="iban" readonly />
            </div>

            <div class="col-md-12 mt-2 text-end">
              <button type="button" class="btn btn-outline-danger" (click)="removeCompte(i)">Supprimer</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Ajouter un compte -->
      <div class="mb-3" *ngIf="getAvailableAccountTypes().length > 0">
        <label>Ajouter un compte</label>
        <div class="input-group">
          <select class="form-select" [formControl]="accountTypeToAdd">
            <option value="">-- Sélectionner un type --</option>
            <option *ngFor="let type of getAvailableAccountTypes()" [value]="type">{{ type }}</option>
          </select>
          <button
            type="button"
            class="btn btn-outline-primary"
            (click)="addCompte(accountTypeToAdd.value!)"
            [disabled]="!accountTypeToAdd.value"
          >
            Ajouter
          </button>
        </div>
      </div>

      <button type="submit" [disabled]="registerForm.invalid" class="btn btn-primary mt-3" data-cy="submit">S'inscrire</button>
    </form>

    <div class="mt-4 alert alert-warning">
      <span jhiTranslate="global.messages.info.authenticated.prefix">Si vous avez déjà un compte, </span>
      <a class="alert-link" routerLink="/login" jhiTranslate="global.messages.info.authenticated.link">connectez-vous</a>
      <span jhiTranslate="global.messages.info.authenticated.suffix"> . Comptes de test : admin/admin ou user/user </span>
    </div>
  </div>
</div>
